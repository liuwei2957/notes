### 基于日志的分布式请求跟踪系统

#### 核心

调用链

1. 每次请求都生成一个全局唯一的id（traceid）,通过它将不同系统生成的日志串在一起，重组成调用链

### 整体架构

#### 埋点和生成日志

1. java探针（-javaagent技术）通过本地socket将收集到的数据实时发送给本机上的日志收集节点agent，将本机上多个java探针的日志数据发送到日志收集服务器集群

#### 收集和存储日志

1. 日志收集服务器集群对数据进行格式化处理后，分成三个工作流进行后续处理

#### 汇总和重组调用链

#### 分析和统计调用链

1. 原始数据直接存入到es集群中，用于页面实时调用链的展示
2. 原始数据存入本地日志中，通过flume上传到hdfs集群中，利用hadoop集群定时的进行离线分析，分析后的结果存入到es集群中，用于页面数据分析的展示
3. 原始数据发送到spark/flink在线分析集群，进行qps，平均耗时等实时数据统计，分别将统计结果保存到redis集群与es集群中，用于页面实时数据统计的展示