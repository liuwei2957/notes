### 高可用设计

#### 什么是高可用

7x24，任何人，任何时间，任何地点，任何服务，都能得到想要的结果

#### 为什么需要高可用

1. 硬件：生命周期，硬件故障，网络划分（CA不存在，没有网络划分，是单机）
2. 软件：bug，性能极限，软件间相互影响

#### 评估方式

1. n个9
2. 停机时间影响请求量/总的请求量

#### 设计手段

1. 服务冗余，无状态化：快速扩容，弹性缩容
2. 负载均衡，幂等设计：
3. 超时机制
4. 异步化设计，非核心流量异步化，减少主流程
5. 服务限流降级熔断
6. 数据复制/缓存/sharding
7. 架构拆分，服务治理
8. 服务实时监控
9. 服务分级，不同级别服务故障影响程度不一样

#### 如何无缝停止线上服务

1. 网关层已具备热切换能力，热开关切换，网关拒绝所有还没到业务逻辑层的请求，进入业务层逻辑层的请求继续处理，可以通过日志查看所有请求是否处理完毕，然后停机，前端也可以用超时时间来控制，过超时时间后停止网关（先关网关，网关里的io线程把请求入队，worker线程从队列获取请求处理之前判断热开关是否开启）
2. 网关层不已具备热切换能力，iptables防火墙限制请求只出不进



### 高并发设计

#### 系统性能

1. 吞吐量
2. 响应延迟

#### 性能优化目标

1. 缩短响应时间
2. 提高并发数（增加吞吐量）
3. 让系统处于合理状态（机器资源利用率，响应延迟，吞吐量）

#### 优化手段

1. 空间换时间：系统时间是瓶颈，如缓存复用计算结果，降低时间开销，因为CPU时间较内存容量更加昂贵

